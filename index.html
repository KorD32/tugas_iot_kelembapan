<body>
    <div id="loginform">
        <h2>
            Smart Plant Green House
            <input type="email" id = "email" placeholder="Email">
            <input type="password" id = "password" placeholder="Password">
            <button id="loginbutton">Login</button> 
        </h2>
    </div>

    <div id= "dashboard">
        <h1>Smart Plant Green House</h1>
        <div class="card">
            <h3>Kelembapan Tanah</h3>
            <div id="soilMoisture">-- %</div>
            <span id="soilStatus"></span>
        </div>
        <div class="card">
            <h3>Tingkat Cahaya</h3>
            <div id="lightLevel">-- %</div>
            <span id="lightStatus"></span>
        </div>
        <div class="card">
            <h3>Gerakan (PIR)</h3>
            <div id="motion">--</div>
            <span id="motionStatus"></span>
        </div>

        <button id="logoutbutton">Logout</button>
    </div>
</body>

<script>
    document.getElementById('loginbutton').addEventListener('click', function() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        signInWithEmailAndPassword(auth, email, password)
            .then(() => {
                document.getElementById('loginform').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                listenToSensors();
            })
            .catch((error) => {
                alert(error.message + " login failed");
            });
    });
    document.getElementById('logoutbutton').addEventListener('click', function() {
        signOut(auth)
        .then(() => {
            dashboard.style.display = 'none';
            loginform.style.display = 'block';
        })
        .catch((error) => {alert(error.message + " logout failed");});
    });
    function listenToSensors() {
        const sensorRef = ref(db, "greenhouse/sensors");

        onValue(sensorRef, (snapshot) => {
            const d = snapshot.val() || {};
            updateSoil(d.soilMoisture);
            updateLight(d.lightLevel);
            updateMotion(d.motion);
        });
    }
    function updateSoil(value) {
        document.getElementById('soilMoisture').textContent = value + '%';
        const status = value < 30 ? 'Kering' : value < 60 ? 'Lembab' : 'Basah';
        document.getElementById('soilStatus').textContent = status;
    }

    function updateLight(value) {
        document.getElementById('lightLevel').textContent = value + '%';
        const status = value < 30 ? 'Rendah' : value < 60 ? 'Sedang' : 'Tinggi';
        document.getElementById('lightStatus').textContent = status;
    }
    function updateMotion(value) {
        document.getElementById('motion').textContent = value ? 'Aktif' : 'Tidak Aktif';
        const status = value ? 'Ada Gerakan' : 'Aman';
        document.getElementById('motionStatus').textContent = value ? 'Aktif' : 'Tidak Aktif';
    }

</script>